<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Web Portal</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Login Screen -->
    <section id="login-section" class="container">
      <div class="card auth">
        <h1>Admin Web Portal</h1>
        <p class="subtitle">Sign in to manage admins and complaints</p>

        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="admin@example.com" />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="••••••••" />
        </div>
        <button id="btn-login" class="btn primary">Sign in</button>
        <p id="login-error" class="error"></p>
        <p class="auth-switch">Don't have an account? <a href="#" id="show-register">Register here</a></p>
      </div>
    </section>

    <!-- Registration Screen -->
    <section id="register-section" class="container hidden">
      <div class="card auth">
        <h1>Admin Registration</h1>
        <p class="subtitle">Register to become an admin (approval required)</p>

        <div class="form-group">
          <label for="reg-fullname">Full Name</label>
          <input id="reg-fullname" type="text" placeholder="John Doe" required />
        </div>
        <div class="form-group">
          <label for="reg-email">Email</label>
          <input id="reg-email" type="email" placeholder="admin@example.com" required />
        </div>
        <div class="form-group">
          <label for="reg-college">College Name</label>
          <input id="reg-college" type="text" placeholder="ABC College" required />
        </div>
        <div class="form-group">
          <label for="reg-department">Department</label>
          <input id="reg-department" type="text" placeholder="Computer Science" required />
        </div>
        <div class="form-group">
          <label for="reg-designation">Designation</label>
          <input id="reg-designation" type="text" placeholder="Professor" required />
        </div>
        <div class="form-group">
          <label for="reg-password">Password</label>
          <input id="reg-password" type="password" placeholder="••••••••" required />
        </div>
        <div class="form-group">
          <label for="reg-confirm-password">Confirm Password</label>
          <input id="reg-confirm-password" type="password" placeholder="••••••••" required />
        </div>
        <button id="btn-register" class="btn primary">Register</button>
        <p id="register-error" class="error"></p>
        <p class="auth-switch">Already have an account? <a href="#" id="show-login">Sign in here</a></p>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="hidden">
      <header class="topbar">
        <div class="brand">Admin Web Portal</div>
       
        <nav class="topbar-nav">
          <button class="nav-link active" data-target="admins-view" style="position: relative;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Admins</span>
            <span id="admins-badge" class="chat-badge hidden">0</span>
          </button>
          <button class="nav-link" data-target="complaints-view" style="position: relative;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>Complaints</span>
            <span id="complaints-badge" class="chat-badge hidden">0</span>
          </button>
             <button class="nav-link" data-target="analytics-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>Analytics</span>
          </button>
          <button class="nav-link" data-target="chat-view" style="position: relative;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat" viewBox="0 0 16 16">
  <path d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105"/>
</svg>
            <span>Chat</span>
            <span id="chat-badge" class="chat-badge hidden">0</span>
          </button>
          <button class="nav-link" data-target="profile-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profile</span>
          </button>
        </nav>
        <div class="spacer"></div>
        <div id="current-user" class="user"></div>
        <button id="btn-logout" class="btn outline small">Logout</button>
      </header>

      <div class="content">
        <main class="main">
          <!-- Admins View -->
          <section id="admins-view" class="view">
            <h2>Admins</h2>
            <div class="cards">
              <div class="stat-card">
                <div class="stat-title">Total</div>
                <div id="admins-total" class="stat-value">-</div>
              </div>
              <div class="stat-card pending">
                <div class="stat-title">Pending</div>
                <div id="admins-pending" class="stat-value">-</div>
              </div>
              <div class="stat-card approved">
                <div class="stat-title">Approved</div>
                <div id="admins-approved" class="stat-value">-</div>
              </div>
              <div class="stat-card rejected">
                <div class="stat-title">Rejected</div>
                <div id="admins-rejected" class="stat-value">-</div>
              </div>
                 <div class="stat-card deactivate">
                <div class="stat-title">Deactivate</div>
                <div id="admins-deactivate" class="stat-value">-</div>
              </div>
            </div>

            <div class="toolbar">
              <div class="form-group inline">
                <label for="admin-status-filter">Status</label>
                <select id="admin-status-filter">
                  <option>All</option>
                  <option>Pending</option>
                  <option>Approved</option>
                  <option>Rejected</option>
                  <option>Deactivate</option>
                </select>
              </div>
              <div class="form-group inline">
                <label for="admin-search">Search</label>
                <input id="admin-search" type="text" placeholder="Name, email, college, department" />
              </div>
            </div>

            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>College</th>
                    <th>Department</th>
                    <th>Designation</th>
                    <th>Status</th>
                    <th>Active</th>
                    <th>Registered</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="admins-tbody">
                  <!-- Rows injected by JS -->
                </tbody>
              </table>
              <div id="admins-empty" class="empty hidden">No admins found.</div>
            </div>
          </section>

          <!-- Complaints View -->
          <section id="complaints-view" class="view hidden">
            <h2>Complaints</h2>
            <div class="toolbar">
              <div class="form-group inline">
                <label for="complaint-status-filter">Status</label>
                <select id="complaint-status-filter">
                  <option>All</option>
                  <option>Pending</option>
                  <option>In Progress</option>
                  <option>Resolved</option>
                  <option>Rejected</option>
                </select>
              </div>
              <div class="form-group inline">
                <label for="complaint-search">Search</label>
                <input id="complaint-search" type="text" placeholder="Title, category, description" />
              </div>
            </div>

            <!-- Export Toolbar -->
            <div class="toolbar" style="background: #0b1220; padding: 16px; border-radius: 12px; margin-bottom: 16px; border: 1px solid var(--border);">
              <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                <span style="font-weight: 600; color: var(--text); display: inline-flex; align-items: center;">📤 Export & Reports:</span>
                <button id="btn-export-csv" class="btn small primary" title="Export to CSV" style="display: inline-flex; align-items: center; gap: 6px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-spreadsheet" viewBox="0 0 16 16">
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V9H3V2a1 1 0 0 1 1-1h5.5zM3 12v-2h2v2zm0 1h2v2H4a1 1 0 0 1-1-1zm3 2v-2h3v2zm4 0v-2h3v1a1 1 0 0 1-1 1zm3-3h-3v-2h3zm-7 0v-2h3v2z"/>
                  </svg>
                  <span>CSV/Excel</span>
                </button>
                <button id="btn-export-pdf" class="btn small success" title="Generate PDF Report" style="display: inline-flex; align-items: center; gap: 6px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-pdf" viewBox="0 0 16 16">
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                    <path d="M4.603 14.087a.8.8 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.7 7.7 0 0 1 1.482-.645 20 20 0 0 0 1.062-2.227 7.3 7.3 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.188-.012.396-.047.614-.084.51-.27 1.134-.52 1.794a11 11 0 0 0 .98 1.686 5.8 5.8 0 0 1 1.334.05c.364.066.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.86.86 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.7 5.7 0 0 1-.911-.95 11.7 11.7 0 0 0-1.997.406 11.3 11.3 0 0 1-1.02 1.51c-.292.35-.609.656-.927.787a.8.8 0 0 1-.58.029m1.379-1.901q-.25.115-.459.238c-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361q.016.032.026.044l.035-.012c.137-.056.355-.235.635-.572a8 8 0 0 0 .45-.606m1.64-1.33a13 13 0 0 1 1.01-.193 12 12 0 0 1-.51-.858 21 21 0 0 1-.5 1.05zm2.446.45q.226.245.435.41c.24.19.407.253.498.256a.1.1 0 0 0 .07-.015.3.3 0 0 0 .094-.125.44.44 0 0 0 .059-.2.1.1 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a4 4 0 0 0-.612-.053zM8.078 7.8a7 7 0 0 0 .2-.828q.046-.282.038-.465a.6.6 0 0 0-.032-.198.5.5 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822q.036.167.09.346z"/>
                  </svg>
                  <span>PDF Report</span>
                </button>
                <button id="btn-share-dashboard" class="btn small" style="background: #ff6b6b; color: white; display: inline-flex; align-items: center; gap: 6px;" title="Generate Shareable Dashboard Link">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                  </svg>
                  <span>Share Dashboard</span>
                </button>
              </div>
            </div>

            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Submitted</th>
                    <th>Anon ID</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="complaints-tbody">
                  <!-- Rows injected by JS -->
                </tbody>
              </table>
              <div id="complaints-empty" class="empty hidden">No complaints found.</div>
            </div>

            <!-- Modal for updating complaint -->
            <dialog id="complaint-modal">
              <form method="dialog" class="modal">
                <h3 id="modal-title">Update Complaint</h3>
                <div id="modal-body"></div>
                <menu class="modal-actions">
                  <button value="cancel" class="btn">Cancel</button>
                  <button id="modal-delete" type="button" class="btn danger">Delete</button>
                  <button id="modal-save" value="default" class="btn primary">Save</button>
                </menu>
              </form>
            </dialog>
          </section>

          <!-- Analytics View -->
          <section id="analytics-view" class="view hidden">
            <h2>Analytics</h2>
            
            <!-- Time Period Filter -->
            <div class="toolbar">
              <div class="form-group inline">
                <label for="analytics-period">Time Period</label>
                <select id="analytics-period">
                  <option value="7">Last 7 Days</option>
                  <option value="30" selected>Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                  <option value="all">All Time</option>
                </select>
              </div>
            </div>

            <!-- Urgent Complaints Alert -->
            <div id="urgent-alert" class="urgent-alert hidden">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <div>
                <strong>Urgent Complaints</strong>
                <span id="urgent-count">0</span> high priority complaints need attention
              </div>
            </div>

            <!-- Key Metrics -->
            <div class="analytics-grid">
              <div class="stat-card">
                <div class="stat-title">Total Complaints</div>
                <div id="analytics-total" class="stat-value">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Resolution Rate</div>
                <div id="analytics-resolution-rate" class="stat-value">0%</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Avg Resolution Time</div>
                <div id="analytics-avg-time" class="stat-value">-</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Pending</div>
                <div id="analytics-pending" class="stat-value pending-stat">0</div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
              <!-- Status Distribution -->
              <div class="chart-card">
                <h3>Status Distribution</h3>
                <div id="status-chart" class="chart-bars"></div>
              </div>

              <!-- Category Distribution -->
              <div class="chart-card">
                <h3>Most Common Categories</h3>
                <div id="category-chart" class="chart-bars"></div>
              </div>
            </div>

            <!-- Trend Chart -->
            <div class="chart-card full-width">
              <h3>Daily Complaint Trends</h3>
              <div id="trend-chart" class="trend-chart"></div>
            </div>

            <!-- Priority Distribution -->
            <div class="chart-card">
              <h3>Priority Distribution</h3>
              <div id="priority-chart" class="chart-bars"></div>
            </div>
          </section>

          <!-- Chat View -->
          <section id="chat-view" class="view hidden">
            <h2>Admin Chats</h2>
            
            <!-- Pending Requests -->
            <div id="pending-requests-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Pending Chat Requests</h3>
              <div id="pending-requests-list" class="chat-requests-grid"></div>
              <div id="no-pending-requests" class="empty hidden">No pending chat requests</div>
            </div>

            <!-- Active Chats -->
            <div id="active-chats-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Active Chats</h3>
              <div id="active-chats-list" class="chat-requests-grid"></div>
              <div id="no-active-chats" class="empty hidden">No active chats</div>
            </div>

            <!-- Ended Chats -->
            <div id="ended-chats-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Ended Chats</h3>
              <div id="ended-chats-list" class="chat-requests-grid"></div>
              <div id="no-ended-chats" class="empty hidden">No ended chats</div>
            </div>
          </section>

          <!-- Chat Window Modal -->
          <dialog id="chat-window-modal">
            <div class="chat-modal">
              <div class="chat-header">
              <div>
                  <h3 id="chat-admin-name" style="margin: 0;">Chat</h3>
                  <p id="chat-admin-email" style="margin: 4px 0 0; color: var(--muted); font-size: 13px;"></p>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                  <button id="btn-auto-reply" class="btn small" style="background: #10b981; color: white; display: flex; align-items: center; gap: 6px;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    <span id="auto-reply-text">Auto-Reply OFF</span>
                  </button>
                  <button id="btn-close-chat" class="btn small">Close</button>
                </div>
              </div>
              
              <div id="typing-indicator" class="typing-indicator hidden">
                <span>Admin is typing</span>
                <span class="typing-dots">
                  <span>.</span><span>.</span><span>.</span>
                </span>
              </div>
              
              <div id="auto-reply-indicator" class="auto-reply-indicator hidden">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                </svg>
                <span>Auto-reply detected: <strong id="auto-reply-category">problem</strong></span>
              </div>
              
              <div id="chat-messages" class="chat-messages"></div>
              
              <div class="chat-input-container">
                <textarea id="chat-input" placeholder="Type a message..." rows="2"></textarea>
                <button id="btn-send-message" class="btn primary">Send</button>
              </div>
            </div>
          </dialog>

          <!-- Profile View -->
          <section id="profile-view" class="view hidden">
            <h2>My Profile</h2>
            <div class="card profile-card">
              <div id="profile-display">
                <div class="form-group">
                  <label>Admin ID</label>
                  <div class="profile-value" id="profile-id-display">-</div>
                </div>
                <div class="form-group">
                  <label>Full Name</label>
                  <div class="profile-value" id="profile-name-display">-</div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <div class="profile-value" id="profile-email-display">-</div>
                </div>
                <div class="form-group">
                  <label>College Name</label>
                  <div class="profile-value" id="profile-college-display">-</div>
                </div>
                <div class="form-group">
                  <label>Department</label>
                  <div class="profile-value" id="profile-department-display">-</div>
                </div>
                <div class="form-group">
                  <label>Designation</label>
                  <div class="profile-value" id="profile-designation-display">-</div>
                </div>
                <div class="form-group">
                  <label>Status</label>
                  <div class="profile-value" id="profile-status-display">-</div>
                </div>
                <div class="form-group">
                  <label>Registration Date</label>
                  <div class="profile-value" id="profile-reg-date-display">-</div>
                </div>
                <button id="btn-edit-profile" class="btn primary">Edit Profile</button>
              </div>

              <div id="profile-edit" class="hidden">
                <div class="form-group">
                  <label for="profile-name-edit">Full Name</label>
                  <input id="profile-name-edit" type="text" placeholder="Full Name" />
                </div>
                <div class="form-group">
                  <label for="profile-college-edit">College Name</label>
                  <input id="profile-college-edit" type="text" placeholder="College Name" />
                </div>
                <div class="form-group">
                  <label for="profile-department-edit">Department</label>
                  <input id="profile-department-edit" type="text" placeholder="Department" />
                </div>
                <div class="form-group">
                  <label for="profile-designation-edit">Designation</label>
                  <input id="profile-designation-edit" type="text" placeholder="Designation" />
                </div>
                <div class="form-actions">
                  <button id="btn-cancel-profile" class="btn">Cancel</button>
                  <button id="btn-update-profile" class="btn primary">Update Profile</button>
                </div>
                <p id="profile-update-error" class="error"></p>
                <p id="profile-update-success" class="success"></p>
              </div>
            </div>
          </section>

          <!-- Modal for viewing admin details -->
          <dialog id="admin-details-modal">
            <form method="dialog" class="modal">
              <h3>Admin Details</h3>
              <div id="admin-modal-body"></div>
              <menu class="modal-actions">
                <button value="cancel" class="btn">Close</button>
              </menu>
            </form>
          </dialog>

        </main>
      </div>
    </section>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <!-- Export Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script src="app.js"></script>
</body>
</html>
