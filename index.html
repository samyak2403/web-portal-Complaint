<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Web Portal</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Login Screen -->
    <section id="login-section" class="container">
      <div class="card auth">
        <h1>Admin Web Portal</h1>
        <p class="subtitle">Sign in to manage admins and complaints</p>

        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="admin@example.com" />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="••••••••" />
        </div>
        <button id="btn-login" class="btn primary">Sign in</button>
        <p id="login-error" class="error"></p>
        <p class="auth-switch">Don't have an account? <a href="#" id="show-register">Register here</a></p>
      </div>
    </section>

    <!-- Registration Screen -->
    <section id="register-section" class="container hidden">
      <div class="card auth">
        <h1>Admin Registration</h1>
        <p class="subtitle">Register to become an admin (approval required)</p>

        <div class="form-group">
          <label for="reg-fullname">Full Name</label>
          <input id="reg-fullname" type="text" placeholder="John Doe" required />
        </div>
        <div class="form-group">
          <label for="reg-email">Email</label>
          <input id="reg-email" type="email" placeholder="admin@example.com" required />
        </div>
        <div class="form-group">
          <label for="reg-college">College Name</label>
          <input id="reg-college" type="text" placeholder="ABC College" required />
        </div>
        <div class="form-group">
          <label for="reg-department">Department</label>
          <input id="reg-department" type="text" placeholder="Computer Science" required />
        </div>
        <div class="form-group">
          <label for="reg-designation">Designation</label>
          <input id="reg-designation" type="text" placeholder="Professor" required />
        </div>
        <div class="form-group">
          <label for="reg-password">Password</label>
          <input id="reg-password" type="password" placeholder="••••••••" required />
        </div>
        <div class="form-group">
          <label for="reg-confirm-password">Confirm Password</label>
          <input id="reg-confirm-password" type="password" placeholder="••••••••" required />
        </div>
        <button id="btn-register" class="btn primary">Register</button>
        <p id="register-error" class="error"></p>
        <p class="auth-switch">Already have an account? <a href="#" id="show-login">Sign in here</a></p>
      </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" class="hidden">
      <header class="topbar">
        <div class="brand">Admin Web Portal</div>
       
        <nav class="topbar-nav">
          <button class="nav-link active" data-target="admins-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="9" cy="7" r="4"></circle>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Admins</span>
          </button>
          <button class="nav-link" data-target="complaints-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>Complaints</span>
          </button>
             <button class="nav-link" data-target="analytics-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>Analytics</span>
          </button>
             <button class="nav-link" data-target="chat-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Chat</span>
          </button>
          <button class="nav-link" data-target="profile-view">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>Profile</span>
          </button>
        </nav>
        <div class="spacer"></div>
        <div id="current-user" class="user"></div>
        <button id="btn-logout" class="btn outline small">Logout</button>
      </header>

      <div class="content">
        <main class="main">
          <!-- Admins View -->
          <section id="admins-view" class="view">
            <h2>Admins</h2>
            <div class="cards">
              <div class="stat-card">
                <div class="stat-title">Total</div>
                <div id="admins-total" class="stat-value">-</div>
              </div>
              <div class="stat-card pending">
                <div class="stat-title">Pending</div>
                <div id="admins-pending" class="stat-value">-</div>
              </div>
              <div class="stat-card approved">
                <div class="stat-title">Approved</div>
                <div id="admins-approved" class="stat-value">-</div>
              </div>
              <div class="stat-card rejected">
                <div class="stat-title">Rejected</div>
                <div id="admins-rejected" class="stat-value">-</div>
              </div>
            </div>

            <div class="toolbar">
              <div class="form-group inline">
                <label for="admin-status-filter">Status</label>
                <select id="admin-status-filter">
                  <option>All</option>
                  <option>Pending</option>
                  <option>Approved</option>
                  <option>Rejected</option>
                </select>
              </div>
              <div class="form-group inline">
                <label for="admin-search">Search</label>
                <input id="admin-search" type="text" placeholder="Name, email, college, department" />
              </div>
            </div>

            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>College</th>
                    <th>Department</th>
                    <th>Designation</th>
                    <th>Status</th>
                    <th>Active</th>
                    <th>Registered</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="admins-tbody">
                  <!-- Rows injected by JS -->
                </tbody>
              </table>
              <div id="admins-empty" class="empty hidden">No admins found.</div>
            </div>
          </section>

          <!-- Complaints View -->
          <section id="complaints-view" class="view hidden">
            <h2>Complaints</h2>
            <div class="toolbar">
              <div class="form-group inline">
                <label for="complaint-status-filter">Status</label>
                <select id="complaint-status-filter">
                  <option>All</option>
                  <option>Pending</option>
                  <option>In Progress</option>
                  <option>Resolved</option>
                  <option>Rejected</option>
                </select>
              </div>
              <div class="form-group inline">
                <label for="complaint-search">Search</label>
                <input id="complaint-search" type="text" placeholder="Title, category, description" />
              </div>
            </div>

            <div class="table-wrapper">
              <table class="table">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Submitted</th>
                    <th>Anon ID</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="complaints-tbody">
                  <!-- Rows injected by JS -->
                </tbody>
              </table>
              <div id="complaints-empty" class="empty hidden">No complaints found.</div>
            </div>

            <!-- Modal for updating complaint -->
            <dialog id="complaint-modal">
              <form method="dialog" class="modal">
                <h3 id="modal-title">Update Complaint</h3>
                <div id="modal-body"></div>
                <menu class="modal-actions">
                  <button value="cancel" class="btn">Cancel</button>
                  <button id="modal-save" value="default" class="btn primary">Save</button>
                </menu>
              </form>
            </dialog>
          </section>

          <!-- Analytics View -->
          <section id="analytics-view" class="view hidden">
            <h2>Analytics</h2>
            
            <!-- Time Period Filter -->
            <div class="toolbar">
              <div class="form-group inline">
                <label for="analytics-period">Time Period</label>
                <select id="analytics-period">
                  <option value="7">Last 7 Days</option>
                  <option value="30" selected>Last 30 Days</option>
                  <option value="90">Last 90 Days</option>
                  <option value="all">All Time</option>
                </select>
              </div>
            </div>

            <!-- Urgent Complaints Alert -->
            <div id="urgent-alert" class="urgent-alert hidden">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
              <div>
                <strong>Urgent Complaints</strong>
                <span id="urgent-count">0</span> high priority complaints need attention
              </div>
            </div>

            <!-- Key Metrics -->
            <div class="analytics-grid">
              <div class="stat-card">
                <div class="stat-title">Total Complaints</div>
                <div id="analytics-total" class="stat-value">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Resolution Rate</div>
                <div id="analytics-resolution-rate" class="stat-value">0%</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Avg Resolution Time</div>
                <div id="analytics-avg-time" class="stat-value">-</div>
              </div>
              <div class="stat-card">
                <div class="stat-title">Pending</div>
                <div id="analytics-pending" class="stat-value pending-stat">0</div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
              <!-- Status Distribution -->
              <div class="chart-card">
                <h3>Status Distribution</h3>
                <div id="status-chart" class="chart-bars"></div>
              </div>

              <!-- Category Distribution -->
              <div class="chart-card">
                <h3>Most Common Categories</h3>
                <div id="category-chart" class="chart-bars"></div>
              </div>
            </div>

            <!-- Trend Chart -->
            <div class="chart-card full-width">
              <h3>Daily Complaint Trends</h3>
              <div id="trend-chart" class="trend-chart"></div>
            </div>

            <!-- Priority Distribution -->
            <div class="chart-card">
              <h3>Priority Distribution</h3>
              <div id="priority-chart" class="chart-bars"></div>
            </div>
          </section>

          <!-- Chat View -->
          <section id="chat-view" class="view hidden">
            <h2>Admin Chats</h2>
            
            <!-- Pending Requests -->
            <div id="pending-requests-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Pending Chat Requests</h3>
              <div id="pending-requests-list" class="chat-requests-grid"></div>
              <div id="no-pending-requests" class="empty hidden">No pending chat requests</div>
            </div>

            <!-- Active Chats -->
            <div id="active-chats-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Active Chats</h3>
              <div id="active-chats-list" class="chat-requests-grid"></div>
              <div id="no-active-chats" class="empty hidden">No active chats</div>
            </div>

            <!-- Ended Chats -->
            <div id="ended-chats-section">
              <h3 style="color: var(--muted); font-size: 16px; margin: 16px 0 12px;">Ended Chats</h3>
              <div id="ended-chats-list" class="chat-requests-grid"></div>
              <div id="no-ended-chats" class="empty hidden">No ended chats</div>
            </div>
          </section>

          <!-- Chat Window Modal -->
          <dialog id="chat-window-modal">
            <div class="chat-modal">
              <div class="chat-header">
                <div>
                  <h3 id="chat-admin-name" style="margin: 0;">Chat</h3>
                  <p id="chat-admin-email" style="margin: 4px 0 0; color: var(--muted); font-size: 13px;"></p>
                </div>
                <button id="btn-close-chat" class="btn small">Close</button>
              </div>
              
              <div id="typing-indicator" class="typing-indicator hidden">
                <span>Admin is typing</span>
                <span class="typing-dots">
                  <span>.</span><span>.</span><span>.</span>
                </span>
              </div>
              
              <div id="chat-messages" class="chat-messages"></div>
              
              <div class="chat-input-container">
                <textarea id="chat-input" placeholder="Type a message..." rows="2"></textarea>
                <button id="btn-send-message" class="btn primary">Send</button>
              </div>
            </div>
          </dialog>

          <!-- Profile View -->
          <section id="profile-view" class="view hidden">
            <h2>My Profile</h2>
            <div class="card profile-card">
              <div id="profile-display">
                <div class="form-group">
                  <label>Admin ID</label>
                  <div class="profile-value" id="profile-id-display">-</div>
                </div>
                <div class="form-group">
                  <label>Full Name</label>
                  <div class="profile-value" id="profile-name-display">-</div>
                </div>
                <div class="form-group">
                  <label>Email</label>
                  <div class="profile-value" id="profile-email-display">-</div>
                </div>
                <div class="form-group">
                  <label>College Name</label>
                  <div class="profile-value" id="profile-college-display">-</div>
                </div>
                <div class="form-group">
                  <label>Department</label>
                  <div class="profile-value" id="profile-department-display">-</div>
                </div>
                <div class="form-group">
                  <label>Designation</label>
                  <div class="profile-value" id="profile-designation-display">-</div>
                </div>
                <div class="form-group">
                  <label>Status</label>
                  <div class="profile-value" id="profile-status-display">-</div>
                </div>
                <div class="form-group">
                  <label>Registration Date</label>
                  <div class="profile-value" id="profile-reg-date-display">-</div>
                </div>
                <button id="btn-edit-profile" class="btn primary">Edit Profile</button>
              </div>

              <div id="profile-edit" class="hidden">
                <div class="form-group">
                  <label for="profile-name-edit">Full Name</label>
                  <input id="profile-name-edit" type="text" placeholder="Full Name" />
                </div>
                <div class="form-group">
                  <label for="profile-college-edit">College Name</label>
                  <input id="profile-college-edit" type="text" placeholder="College Name" />
                </div>
                <div class="form-group">
                  <label for="profile-department-edit">Department</label>
                  <input id="profile-department-edit" type="text" placeholder="Department" />
                </div>
                <div class="form-group">
                  <label for="profile-designation-edit">Designation</label>
                  <input id="profile-designation-edit" type="text" placeholder="Designation" />
                </div>
                <div class="form-actions">
                  <button id="btn-cancel-profile" class="btn">Cancel</button>
                  <button id="btn-update-profile" class="btn primary">Update Profile</button>
                </div>
                <p id="profile-update-error" class="error"></p>
                <p id="profile-update-success" class="success"></p>
              </div>
            </div>
          </section>

          <!-- Modal for viewing admin details -->
          <dialog id="admin-details-modal">
            <form method="dialog" class="modal">
              <h3>Admin Details</h3>
              <div id="admin-modal-body"></div>
              <menu class="modal-actions">
                <button value="cancel" class="btn">Close</button>
              </menu>
            </form>
          </dialog>

        </main>
      </div>
    </section>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script src="app.js"></script>
</body>
</html>
